{"version":3,"file":"index.esm.js","sources":["../src/dom.ts","../src/Canvas2DContextService.ts","../src/ContextRegisterPlugin.ts","../src/index.ts"],"sourcesContent":["function isCanvasElement(el) {\n    if (!el || typeof el !== 'object')\n        return false;\n    if (el.nodeType === 1 && el.nodeName) {\n        // HTMLCanvasElement\n        return true;\n    }\n    // CanvasElement\n    return !!el.isCanvasElement;\n}\nexport { isCanvasElement };\n//# sourceMappingURL=dom.js.map","import { __awaiter, __generator } from \"tslib\";\nimport { isCanvasElement } from './dom';\nvar Canvas2DContextService = /** @class */ (function () {\n    function Canvas2DContextService(context) {\n        this.canvasConfig = context.config;\n    }\n    Canvas2DContextService.prototype.init = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, canvas, devicePixelRatio, dpr;\n            return __generator(this, function (_b) {\n                _a = this.canvasConfig, canvas = _a.canvas, devicePixelRatio = _a.devicePixelRatio;\n                this.$canvas = canvas;\n                // 实际获取到小程序环境的上下文\n                this.context = this.$canvas.getContext('2d');\n                dpr = devicePixelRatio || 1;\n                dpr = dpr >= 1 ? Math.ceil(dpr) : 1;\n                this.dpr = dpr;\n                this.resize(this.canvasConfig.width, this.canvasConfig.height);\n                return [2 /*return*/];\n            });\n        });\n    };\n    Canvas2DContextService.prototype.getContext = function () {\n        return this.context;\n    };\n    Canvas2DContextService.prototype.getDomElement = function () {\n        return this.$canvas;\n    };\n    Canvas2DContextService.prototype.getDPR = function () {\n        return this.dpr;\n    };\n    Canvas2DContextService.prototype.getBoundingClientRect = function () {\n        if (this.$canvas.getBoundingClientRect) {\n            return this.$canvas.getBoundingClientRect();\n        }\n    };\n    Canvas2DContextService.prototype.destroy = function () {\n        // TODO: 小程序环境销毁 context\n        this.context = null;\n        this.$canvas = null;\n    };\n    Canvas2DContextService.prototype.resize = function (width, height) {\n        var devicePixelRatio = this.canvasConfig.devicePixelRatio;\n        var pixelRatio = devicePixelRatio;\n        var canvasDOM = this.$canvas; // HTMLCanvasElement or canvasElement\n        // 浏览器环境设置style样式\n        if (canvasDOM.style) {\n            canvasDOM.style.width = width + 'px';\n            canvasDOM.style.height = height + 'px';\n        }\n        if (isCanvasElement(canvasDOM)) {\n            canvasDOM.width = width * pixelRatio;\n            canvasDOM.height = height * pixelRatio;\n            if (pixelRatio !== 1) {\n                this.context.scale(pixelRatio, pixelRatio);\n            }\n        }\n    };\n    Canvas2DContextService.prototype.applyCursorStyle = function (cursor) {\n        // 小程序环境无需设置鼠标样式\n    };\n    Canvas2DContextService.prototype.toDataURL = function (options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var type, encoderOptions;\n            return __generator(this, function (_a) {\n                type = options.type, encoderOptions = options.encoderOptions;\n                return [2 /*return*/, this.context.canvas.toDataURL(type, encoderOptions)];\n            });\n        });\n    };\n    return Canvas2DContextService;\n}());\nexport { Canvas2DContextService };\n//# sourceMappingURL=Canvas2DContextService.js.map","import { __extends } from \"tslib\";\nimport { AbstractRendererPlugin } from '@antv/g-lite';\nimport { Canvas2DContextService } from './Canvas2DContextService';\nvar ContextRegisterPlugin = /** @class */ (function (_super) {\n    __extends(ContextRegisterPlugin, _super);\n    function ContextRegisterPlugin() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.name = 'mobile-canvas-context-register';\n        return _this;\n    }\n    ContextRegisterPlugin.prototype.init = function () {\n        this.context.ContextService = Canvas2DContextService;\n    };\n    ContextRegisterPlugin.prototype.destroy = function () {\n        delete this.context.ContextService;\n    };\n    return ContextRegisterPlugin;\n}(AbstractRendererPlugin));\nexport { ContextRegisterPlugin };\n//# sourceMappingURL=ContextRegisterPlugin.js.map","import { __extends } from \"tslib\";\nimport { AbstractRenderer } from '@antv/g-lite';\nimport * as CanvasPathGenerator from '@antv/g-plugin-canvas-path-generator';\nimport * as CanvasPicker from '@antv/g-plugin-canvas-picker';\nimport * as CanvasRenderer from '@antv/g-plugin-canvas-renderer';\nimport * as DragDropEvent from '@antv/g-plugin-dragndrop';\nimport * as ImageLoader from '@antv/g-plugin-image-loader';\nimport * as MobileInteraction from '@antv/g-plugin-mobile-interaction';\nimport * as GesturePlugin from '@antv/g-plugin-gesture';\nimport { isNil } from '@antv/util';\nimport { ContextRegisterPlugin } from './ContextRegisterPlugin';\nexport { CanvasRenderer, CanvasPicker };\nvar Renderer = /** @class */ (function (_super) {\n    __extends(Renderer, _super);\n    function Renderer(config) {\n        var _this = _super.call(this, config) || this;\n        // register Canvas2DContext\n        _this.registerPlugin(new ContextRegisterPlugin());\n        _this.registerPlugin(new ImageLoader.Plugin());\n        _this.registerPlugin(new CanvasPathGenerator.Plugin());\n        // enable rendering with Canvas2D API\n        _this.registerPlugin(new CanvasRenderer.Plugin());\n        _this.registerPlugin(new MobileInteraction.Plugin());\n        // enable picking with Canvas2D API\n        _this.registerPlugin(new CanvasPicker.Plugin());\n        _this.registerPlugin(new DragDropEvent.Plugin({\n            isDocumentDraggable: isNil(config === null || config === void 0 ? void 0 : config.isDocumentDraggable)\n                ? true\n                : config.isDocumentDraggable,\n            isDocumentDroppable: isNil(config === null || config === void 0 ? void 0 : config.isDocumentDroppable)\n                ? true\n                : config.isDocumentDroppable,\n            dragstartDistanceThreshold: isNil(config === null || config === void 0 ? void 0 : config.dragstartDistanceThreshold)\n                ? 10\n                : config.dragstartDistanceThreshold,\n            dragstartTimeThreshold: isNil(config === null || config === void 0 ? void 0 : config.dragstartTimeThreshold)\n                ? 50\n                : config.dragstartTimeThreshold,\n        }));\n        _this.registerPlugin(new GesturePlugin.Plugin({\n            isDocumentGestureEnabled: true,\n        }));\n        return _this;\n    }\n    return Renderer;\n}(AbstractRenderer));\nexport { Renderer };\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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"}