{"version":3,"file":"index.js","sources":["../src/MobileInteractionPlugin.ts","../src/index.ts"],"sourcesContent":["/**\n * listen to mouse/touch/pointer events on DOM wrapper, trigger pointer events\n */\nvar MobileInteractionPlugin = /** @class */ (function () {\n    function MobileInteractionPlugin() {\n    }\n    MobileInteractionPlugin.prototype.apply = function (context) {\n        var renderingService = context.renderingService, contextService = context.contextService, config = context.config;\n        // 获取小程序上下文\n        var canvasEl = contextService.getDomElement();\n        var onPointerDown = function (ev) {\n            renderingService.hooks.pointerDown.call(ev);\n        };\n        var onPointerUp = function (ev) {\n            renderingService.hooks.pointerUp.call(ev);\n        };\n        var onPointerMove = function (ev) {\n            // 触发 G 定义的标准 pointerMove 事件\n            renderingService.hooks.pointerMove.call(ev);\n        };\n        var onPointerOver = function (ev) {\n            renderingService.hooks.pointerOver.call(ev);\n        };\n        var onPointerOut = function (ev) {\n            renderingService.hooks.pointerOut.call(ev);\n        };\n        var onClick = function (ev) {\n            renderingService.hooks.click.call(ev);\n        };\n        var onPointerCancel = function (ev) {\n            renderingService.hooks.pointerCancel.call(ev);\n        };\n        renderingService.hooks.init.tap(MobileInteractionPlugin.tag, function () {\n            // 基于小程序上下文的事件监听方式，绑定事件监听，可以参考下面基于 DOM 的方式\n            canvasEl.addEventListener('touchstart', onPointerDown, true);\n            canvasEl.addEventListener('touchend', onPointerUp, true);\n            canvasEl.addEventListener('touchmove', onPointerMove, true);\n            canvasEl.addEventListener('touchcancel', onPointerCancel, true);\n            // FIXME: 这里不应该只在 canvasEl 上监听 mousemove 和 mouseup，而应该在更高层级的节点上例如 document 监听。\n            // 否则无法判断是否移出了 canvasEl\n            // canvasEl.addEventListener('mousemove', onPointerMove, true);\n            // canvasEl.addEventListener('mousedown', onPointerDown, true);\n            canvasEl.addEventListener('mouseout', onPointerOut, true);\n            canvasEl.addEventListener('mouseover', onPointerOver, true);\n            // canvasEl.addEventListener('mouseup', onPointerUp, true);\n            if (config.useNativeClickEvent) {\n                canvasEl.addEventListener('click', onClick, true);\n            }\n        });\n        renderingService.hooks.destroy.tap(MobileInteractionPlugin.tag, function () {\n            // 基于小程序上下文的事件监听方式，移除事件监听\n            canvasEl.removeEventListener('touchstart', onPointerDown, true);\n            canvasEl.removeEventListener('touchend', onPointerUp, true);\n            canvasEl.removeEventListener('touchmove', onPointerMove, true);\n            canvasEl.removeEventListener('touchcancel', onPointerCancel, true);\n            // canvasEl.removeEventListener('mousemove', onPointerMove, true);\n            // canvasEl.removeEventListener('mousedown', onPointerDown, true);\n            canvasEl.removeEventListener('mouseout', onPointerOut, true);\n            canvasEl.removeEventListener('mouseover', onPointerOver, true);\n            // canvasEl.removeEventListener('mouseup', onPointerUp, true);\n            if (config.useNativeClickEvent) {\n                canvasEl.removeEventListener('click', onClick, true);\n            }\n        });\n    };\n    MobileInteractionPlugin.tag = 'MobileInteraction';\n    return MobileInteractionPlugin;\n}());\nexport { MobileInteractionPlugin };\n//# sourceMappingURL=MobileInteractionPlugin.js.map","import { __extends } from \"tslib\";\nimport { AbstractRendererPlugin } from '@antv/g-lite';\nimport { MobileInteractionPlugin } from './MobileInteractionPlugin';\nvar Plugin = /** @class */ (function (_super) {\n    __extends(Plugin, _super);\n    function Plugin() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.name = 'mobile-interaction';\n        return _this;\n    }\n    Plugin.prototype.init = function () {\n        this.addRenderingPlugin(new MobileInteractionPlugin());\n    };\n    Plugin.prototype.destroy = function () {\n        this.removeAllRenderingPlugins();\n    };\n    return Plugin;\n}(AbstractRendererPlugin));\nexport { Plugin };\n//# sourceMappingURL=index.js.map"],"names":["__extends","AbstractRendererPlugin"],"mappings":"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"}