{"version":3,"file":"index.js","sources":["../src/SVGPickerPlugin.ts","../src/index.ts"],"sourcesContent":["import { __awaiter, __generator, __values } from \"tslib\";\n/**\n * pick shape(s) with Mouse/Touch event\n *\n * 1. find AABB with r-tree\n * 2. use elementFromPoint\n */\nvar SVGPickerPlugin = /** @class */ (function () {\n    function SVGPickerPlugin() {\n    }\n    SVGPickerPlugin.prototype.apply = function (context, runtime) {\n        var _this = this;\n        var doc = context.config.document, renderingService = context.renderingService, \n        // @ts-ignore\n        svgElementMap = context.svgElementMap;\n        renderingService.hooks.pick.tapPromise(SVGPickerPlugin.tag, function (result) { return __awaiter(_this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                return [2 /*return*/, this.pick(svgElementMap, doc, result)];\n            });\n        }); });\n        renderingService.hooks.pickSync.tap(SVGPickerPlugin.tag, function (result) {\n            return _this.pick(svgElementMap, doc, result);\n        });\n    };\n    SVGPickerPlugin.prototype.pick = function (svgElementMap, doc, result) {\n        var e_1, _a;\n        var topmost = result.topmost, _b = result.position, clientX = _b.clientX, clientY = _b.clientY;\n        try {\n            var targets = [];\n            try {\n                // @see https://developer.mozilla.org/zh-CN/docs/Web/API/Document/elementsFromPoint\n                for (var _c = __values((doc || document).elementsFromPoint(clientX, clientY)), _d = _c.next(); !_d.done; _d = _c.next()) {\n                    var element = _d.value;\n                    var target = svgElementMap.get(element);\n                    // don't need to account for `visibility` since DOM API already does\n                    if (target && target.isInteractive()) {\n                        targets.push(target);\n                        if (topmost) {\n                            result.picked = targets;\n                            return result;\n                        }\n                    }\n                }\n            }\n            catch (e_1_1) { e_1 = { error: e_1_1 }; }\n            finally {\n                try {\n                    if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n                }\n                finally { if (e_1) throw e_1.error; }\n            }\n            result.picked = targets;\n        }\n        catch (e) {\n            result.picked = [];\n        }\n        return result;\n    };\n    SVGPickerPlugin.tag = 'SVGPicker';\n    return SVGPickerPlugin;\n}());\nexport { SVGPickerPlugin };\n//# sourceMappingURL=SVGPickerPlugin.js.map","import { __extends } from \"tslib\";\nimport { AbstractRendererPlugin } from '@antv/g-lite';\nimport { SVGPickerPlugin } from './SVGPickerPlugin';\nvar Plugin = /** @class */ (function (_super) {\n    __extends(Plugin, _super);\n    function Plugin() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.name = 'svg-picker';\n        return _this;\n    }\n    Plugin.prototype.init = function () {\n        this.addRenderingPlugin(new SVGPickerPlugin());\n    };\n    Plugin.prototype.destroy = function () {\n        this.removeAllRenderingPlugins();\n    };\n    return Plugin;\n}(AbstractRendererPlugin));\nexport { Plugin };\n//# sourceMappingURL=index.js.map"],"names":["__awaiter","__generator","__values","__extends","AbstractRendererPlugin"],"mappings":"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"}